<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Speed Test + Auto Submit</title>
  <script src="https://librespeed.org/librespeed/speedtest.js"></script>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 2rem; }
    #results { margin-top: 2rem; }
  </style>
</head>
<body>
  <h1>Internet Speed Test</h1>
  <button onclick="startSpeedTest()">Start Test</button>
  <div id="results">
    <p>Download: <span id="download">-</span> Mbps</p>
    <p>Upload: <span id="upload">-</span> Mbps</p>
    <p>Ping: <span id="ping">-</span> ms</p>
  </div>

  <script>
    let s;

    function startSpeedTest() {
      s = new Speedtest({
        telemetry_level: "basic",
        time_ul: 5,
        time_dl: 5,
        getIp_ispInfo: false,
        url_dl: "https://librespeed.org/backend/garbage.php",
        url_ul: "https://librespeed.org/backend/empty.php",
        url_ping: "https://librespeed.org/backend/empty.php"
      });

      s.onupdate = function(data) {
        document.getElementById("download").textContent = (data.dl || 0).toFixed(2);
        document.getElementById("upload").textContent = (data.ul || 0).toFixed(2);
        document.getElementById("ping").textContent = (data.ping || 0).toFixed(2);
      };

      s.onend = function(data) {
        const url = "https://script.google.com/macros/s/AKfycbw35x2ssWDONIa8R03jViKJ0sHw9x8C6CsJGYvj65vHk271m763hDs_DOpKRjfLzeTl/exec";

        fetch(url, {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            download: data.dl.toFixed(2),
            upload: data.ul.toFixed(2),
            ping: data.ping.toFixed(2),
            timestamp: new Date().toISOString(),
            userAgent: navigator.userAgent
          })
        })
        .then(() => {
          alert("Speed test results submitted successfully.");
        })
        .catch(err => console.error("Submission failed:", err));
      };

      s.start();
    }
  </script>
</body>
</html>

